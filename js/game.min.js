class Spring extends createjs.Sprite{constructor(a){super(game.queue.getResult("spring"),"spring"),this.gotoAndStop("spring"),this.scaleX=this.scaleY=0.2,this.width=23.2,this.height=47.6,this.x=a.x+a.width/2-this.width/2,this.y=a.y-this.height,this.platform=a,game.stage.addChild(this)}boost(){this.gotoAndPlay("spring"),game.lastSprings++,game.player.boost=30}}class Player extends createjs.Sprite{constructor(){super(game.queue.getResult("fredJump"),"fred"),this.scaleX=this.scaleY=0.5,this.height=163.5,this.width=90.5,this.hitWidth=this.width/3,this.position=0,this.boost=0,this.reset(),game.stage.addChild(this)}reset(){this.level=game.levels[0],this.moveUp=!0,this.speed=game.maxSpeed,this.x=game.stage.canvas.width/2-this.width/2,this.y=game.stage.canvas.height-this.height}move(){game.tilt&&(0>game.tilt&&0<this.x&&(this.x+=game.tilt/game.sensitivity),0<game.tilt&&this.x<game.stage.canvas.width-this.width&&(this.x+=game.tilt/game.sensitivity),this.rotation=game.tilt/2),game.keys.left&&0<this.x&&(this.x-=game.moveSpeed,createjs.Tween.get(this).to({rotation:-10},100).to({rotation:0},200)),game.keys.right&&this.x<game.stage.canvas.width-this.width&&(this.x+=game.moveSpeed,createjs.Tween.get(this).to({rotation:10},100).to({rotation:0},200))}jump(){0<this.boost?(game.moveUp(game.maxSpeed),this.boost--):this.moveUp?(0>this.y-200?(game.moveUp(this.speed),this.y--):this.y-=this.speed,this.speed/=game.gravity,this.moveUp=1<this.speed):(this.y+=this.speed,this.speed*=game.gravity,this.speed=Math.min(game.maxSpeed,this.speed),this.checkBounce())}checkBounce(){if(this.y+this.height-game.maxSpeed>game.stage.canvas.height)game.end();else for(let a of game.platforms)if(this.moveUp=a.checkBounce(),this.moveUp){if(this.gotoAndPlay("fred"),a.bounce(),this.speed=game.maxSpeed,this.position=a.position,3e8<this.position&&(this.level.rarity=20),this.position>this.level.points&&(this.level=game.levels[game.levels.indexOf(this.level)+1]),game.platforms.filter(b=>b.y>game.stage.canvas.height).forEach(b=>b.clear()),game.createPlatforms(),game.score=Math.floor(Math.max(this.position,game.score)),game.score>game.highScore&&!game.onRecord){game.onRecord=!0;let b=new createjs.Text("New High!","50px riffic","#fdff66");b.x=game.stage.canvas.width/2,b.y=game.stage.canvas.height/2,b.textAlign="center",b.textBaseline="middle",game.stage.addChild(b),createjs.Tween.get(b).wait(500).to({alpha:0},1e3).call(()=>game.stage.removeChild(b))}break}}}class Platform extends createjs.Sprite{constructor(a){let b="regular";1>Math.random()*a.platforms.onebounce&&(b="onebounce"),1>Math.random()*a.platforms.moving&&(b="moving"),super(game.queue.getResult("platforms"),b),this.gotoAndStop(b),this.type=b,this.scaleX=this.scaleY=0.15,this.width=75,this.height=25,this.bounces=0,this.dir="right";let c=game.platforms.length;if(this.level=a,this.speed=Math.random()*this.level.platformMovingSpeed,0<c){let d=game.platforms[c-1];this.y=d.y-this.height-Math.random()*(game.maxSpeed*a.rarity),this.x=Math.random()*(game.stage.canvas.width-this.width)}else this.y=game.stage.canvas.height-this.height-5,this.x=game.stage.canvas.width/2-this.width/2;this.position=game.position+-1*(this.y-game.stage.canvas.height),0.9<Math.random()&&(this.spring=new Spring(this)),game.stage.addChild(this),game.platforms.push(this)}checkBounce(){return!(game.player.x+game.player.width/2-game.player.hitWidth/2>=this.x+this.width||game.player.x+game.player.width/2+game.player.hitWidth/2<=this.x||game.player.y+game.player.height>=this.y+this.height||game.player.y+game.player.height<this.y)}move(){"right"==this.dir?this.x<game.stage.canvas.width-this.width?(this.x+=this.speed,this.spring!=void 0&&(this.spring.x+=this.speed)):this.dir="left":0<this.x?(this.x-=this.speed,this.spring!=void 0&&(this.spring.x-=this.speed)):this.dir="right"}bounce(){if(this.bounces++,game.lastPlatforms++,"moving"==this.type?createjs.Sound.play("jump1"):createjs.Sound.play("jump2"),"onebounce"==this.type&&(createjs.Sound.play("crack2"),createjs.Tween.get(this).to({y:game.stage.canvas.height+100},500,createjs.Ease.circIn).call(()=>{game.platforms.splice(game.platforms.indexOf(this),1),game.stage.removeChild(this)}),this.spring&&createjs.Tween.get(this.spring).to({y:game.stage.canvas.height+100},500,createjs.Ease.circIn)),this.spring){let a=createjs.Sound.play("boost");a.volume=0.8,this.spring.boost()}}clear(){game.stage.removeChild(this),this.spring&&game.stage.removeChild(this.spring),game.platforms.splice(game.platforms.indexOf(this),1)}}class Badge extends createjs.Sprite{constructor(a){super(game.queue.getResult("badges"),game.allBadges[a].type),this.scaleX=this.scaleY=0.3,this.width=150,this.height=112.8,this.x=game.stage.canvas.width/2-this.width/2,this.y=500,this.data=game.allBadges[a],this.txt=new createjs.Text(this.data.text,"40px riffic","#fdff66"),this.txt.x=game.stage.canvas.width/2,this.txt.textAlign="center",this.txt.y=this.y+this.height+10,window.setTimeout(()=>{let c=new createjs.Container;c.addChild(this,this.txt),game.stage.addChild(c),createjs.Sound.play("newBadge"),createjs.Tween.get(c).wait(1e3).to({alpha:0},3e3).call(()=>{game.stage.removeChild(c),game.newBadges--})},4e3*game.newBadges),game.newBadges++,game.badges.push(a);let b=new Date(Date.now()+1e11);document.cookie="badges="+game.badges.join(",")+"; expires="+b.toGMTString()+";"}static getFromCookie(){let a=getCookie("badges");return a?a.split(",").map(Number):[]}static checkForNewBadges(){game.allBadges!=void 0&&game.allBadges.forEach((a,b)=>{if(0>game.badges.indexOf(b)){let c=game.levels.indexOf(game.player.level);switch(a.property){case"totalScore":c=game.totalScore+(game.started?game.score:0);break;case"timer":c=game.started?Date.now()-game.timer:0;break;case"totalTime":c=game.totalTime+(game.started?Date.now()-game.timer:0);break;case"totalPlatforms":c=game.totalPlatforms+(game.started?game.lastPlatforms:0);break;case"totalSprings":c=game.totalSprings+(game.started?game.lastSprings:0);break;case"score":case"gamesPlayed":case"lastPlatforms":case"lastSprings":c=game[a.property];}c>=a.value&&new Badge(b)}})}}let game={started:!1,maxSpeed:20,moveSpeed:7,gravity:1.09,sensitivity:4,tilt:0,newBadges:0,cookies:["badges","highScore","gamesPlayed","totalTime","lastTime","totalPlatforms","lastPlatforms","lastScore","totalScore","lastSprings","totalSprings"]};game.init=()=>{game.stage=new createjs.Stage("myCanvas"),game.cookies.forEach(a=>game[a]=isNaN(getCookie(a))?0:new Number(getCookie(a))),game.badges=Badge.getFromCookie(),game.load(),game.badgeChecker=window.setInterval(Badge.checkForNewBadges,1e3),createjs.Ticker.addEventListener("tick",game.onTick),createjs.Ticker.setFPS(60)},game.load=()=>{game.loading=new createjs.Text("Loading","40px riffic","#fff"),game.loading.textBaseline="middle",game.loading.textAlign="center",game.loading.x=game.stage.canvas.width/2,game.loading.y=game.stage.canvas.height/2,game.stage.addChild(game.loading),game.queue=new createjs.LoadQueue(!0),game.queue.installPlugin(createjs.Sound),game.queue.loadManifest([{id:"levels",src:"js/levels.json"},{id:"badgesData",src:"js/badgesData.json"},{id:"bg1",src:"graphics/lvl1bg.png"},{id:"bg2",src:"graphics/lvl2bg.png"},{id:"bg3",src:"graphics/lvl3bg.png"},{id:"bg4",src:"graphics/lvl4bg.png"},{id:"bg5",src:"graphics/lvl5bg.png"},{id:"bg6",src:"graphics/lvl6bg.png"},{id:"startScreen",src:"graphics/start.png"},{id:"instructionsScreen",src:"graphics/instructions.png"},{id:"endScreen",src:"graphics/end.png"},{id:"statsScreen",src:"graphics/stats.png"},{id:"creditsScreen",src:"graphics/credits.png"},{id:"fredJump",src:"graphics/fredJump/fredJump.json",type:"spritesheet"},{id:"platforms",src:"graphics/platforms/platforms.json",type:"spritesheet"},{id:"spring",src:"graphics/spring/spring.json",type:"spritesheet"},{id:"badges",src:"graphics/badges/badges.json",type:"spritesheet"},{id:"unmuted",src:"graphics/unmuted.png"},{id:"muted",src:"graphics/muted.png"},{id:"pause",src:"graphics/pause.png"},{id:"continue",src:"graphics/continue.png"},{id:"boost",src:"sound/boost.mp3"},{id:"crack1",src:"sound/crack1.mp3"},{id:"crack2",src:"sound/crack2.mp3"},{id:"jump1",src:"sound/jump1.mp3"},{id:"jump2",src:"sound/jump2.mp3"},{id:"end",src:"sound/end.mp3"},{id:"newBadge",src:"sound/badge.mp3"}]),game.queue.on("progress",game.progress),game.queue.on("complete",game.showStartScreen)},game.progress=a=>{let b=Math.round(100*a.progress);game.loading.text="Loading: "+b+"%",game.stage.update()},game.start=()=>{game.stage.removeAllChildren(),game.levels=game.queue.getResult("levels"),game.allBadges=game.queue.getResult("badgesData"),game.platforms=[],game.position=game.score=game.lastSprings=game.lastPlatforms=0,game.timer=Date.now(),game.moving=!1,game.keys={left:!1,right:!1},game.bg=[],game.onRecord=!1,game.createBackgrounds(),game.createStats(),game.player=new Player,game.createPlatforms(),game.showMute(),game.showPause(createjs.Ticker),game.started=!0,window.addEventListener("deviceorientation",game.tilt)},game.createStats=()=>{game.stats=new createjs.Text("","35px riffic","#fdff66"),game.stats.y=30,game.stats.x=game.stage.canvas.width-10,game.stats.textAlign="right",game.badgesCount=new createjs.Text("","20px riffic","#fdff66"),game.badgesCount.y=30,game.badgesCount.x=10,game.stage.addChild(game.stats,game.badgesCount)},game.createBackgrounds=()=>{for(let b,a=game.levels.length-1;0<=a;a--)b=new createjs.Bitmap(game.queue.getResult("bg"+(a+1))),b.x=0,b.y=game.levels[a].bg.y,b.distance=game.levels[a].bg.distance,game.stage.addChild(b),game.bg.push(b)},game.end=()=>{game.started=!1;let a=createjs.Sound.play("end");a.volume=0.1,game.highScore=Math.max(game.highScore,game.score),game.gamesPlayed++,game.totalTime+=game.lastTime=Date.now()-game.timer,game.totalScore+=game.lastScore=game.score,game.totalPlatforms+=game.lastPlatforms,game.totalSprings+=game.lastSprings;let b=new Date(Date.now()+1e11);game.cookies.forEach(c=>document.cookie=c+"="+game[c]+"; expires="+b.toGMTString()+";"),Badge.checkForNewBadges(),game.showEndScreen()},game.moveUp=a=>{game.platforms.forEach(b=>{b.y+=a,b.spring!=void 0&&(b.spring.y+=a)}),game.position+=a;for(let b of game.bg)b.y+=a/game.player.level.bg.distance},game.createPlatforms=()=>{for(;40>game.platforms.length;)new Platform(game.player.level);game.stage.setChildIndex(game.player,game.stage.getNumChildren()-1)},game.onTick=a=>{if(game.started&&!a.paused){game.player.jump(),game.player.move();for(p of game.platforms.filter(b=>"moving"==b.type))p.move();game.stats.text=game.score.toLocaleString()+" m",game.stage.setChildIndex(game.stats,game.stage.getNumChildren()-1),game.badgesCount.text="Badges: "+game.badges.length+"/"+game.allBadges.length,game.stage.setChildIndex(game.badgesCount,game.stage.getNumChildren()-1)}game.stage.update(a)},game.showStartScreen=()=>{game.stage.removeAllChildren();let a=new createjs.Bitmap(game.queue.getResult("startScreen"));a.x=a.y=0,a.scaleX=a.scaleY=0.5;let b=new createjs.Text(game.highScore.toLocaleString()+" m","30px riffic","#fff");b.y=500,b.x=40;let c=new createjs.Shape;c.graphics.beginFill("#fff").drawRect(108,683,268,83),c.alpha=0.01,c.addEventListener("click",game.start);let d=new createjs.Shape;d.graphics.beginFill("#fff").drawRect(0,42,140,138),d.alpha=0.01,d.addEventListener("click",game.showInstructionsScreen);let f=new createjs.Shape;f.graphics.beginFill("#fff").drawCircle(455,25,70),f.alpha=0.01,f.addEventListener("click",game.showStatsScreen),game.stage.addChild(a,b,c,d,f),game.showMute()},game.showInstructionsScreen=()=>{game.stage.removeAllChildren();let a=new createjs.Bitmap(game.queue.getResult("instructionsScreen"));a.x=a.y=0,a.scaleX=a.scaleY=0.5;let b=new createjs.Shape;b.graphics.beginFill("#fff").drawRect(108,683,268,83),b.alpha=0.01,b.addEventListener("click",game.start);let c=new createjs.Shape;c.graphics.beginFill("#fff").drawRect(400,0,100,70),c.alpha=0.01,c.addEventListener("click",game.showStartScreen),game.creditsBtn=new createjs.Shape,game.creditsBtn.graphics.beginFill("#fff").drawRect(55,0,165,30),game.creditsBtn.alpha=0.01,game.creditsBtn.addEventListener("click",game.showCreditsScreen),game.stage.addChild(a,b,c,game.creditsBtn),game.showMute()},game.showCreditsScreen=()=>{game.stage.removeAllChildren();let a=new createjs.Bitmap(game.queue.getResult("creditsScreen"));a.x=a.y=0,a.scaleX=a.scaleY=0.5;let b=new createjs.Shape;b.graphics.beginFill("#fff").drawRect(108,683,268,83),b.alpha=0.01,b.addEventListener("click",game.start);let c=new createjs.Shape;c.graphics.beginFill("#fff").drawRect(400,0,100,70),c.alpha=0.01,c.addEventListener("click",game.showInstructionsScreen),game.stage.addChild(a,b,c),game.showMute()},game.showStatsScreen=()=>{game.stage.removeAllChildren();let a=new createjs.Bitmap(game.queue.getResult("statsScreen"));a.x=a.y=0,a.scaleX=a.scaleY=0.5;let b=new createjs.Shape;b.graphics.beginFill("#fff").drawRect(108,683,268,83),b.alpha=0.01,b.addEventListener("click",game.start);let c=new createjs.Shape;c.graphics.beginFill("#fff").drawRect(400,0,100,70),c.alpha=0.01,c.addEventListener("click",game.showStartScreen);let d="\nTotal distance: "+game.totalScore.toLocaleString()+" m";d+="\nBest distance: "+game.highScore.toLocaleString()+" m",d+="\nLast game distance: "+game.lastScore.toLocaleString()+" m",d+="\n\nGames Played: "+game.gamesPlayed.toLocaleString(),d+="\nTotal time played: "+msToTime(game.totalTime),d+="\nLast game duration: "+msToTime(game.lastTime),d+="\nAverage game duration: "+msToTime(game.totalTime/game.gamesPlayed),d+="\n\nTotal jumps: "+game.totalPlatforms.toLocaleString(),d+="\nJumps in last game: "+game.lastPlatforms.toLocaleString(),d+="\n\nTotal springs jumped: "+game.totalSprings.toLocaleString(),d+="\nSprings jumped in last game: "+game.lastSprings.toLocaleString();let f=new createjs.Text(d,"18px riffic","#fff");f.lineHeight=28,f.y=240,f.x=60,game.stage.addChild(a,b,c,f),game.showMute()},game.showEndScreen=()=>{game.stage.removeAllChildren();let a=new createjs.Bitmap(game.queue.getResult("endScreen"));a.x=a.y=0,a.scaleX=a.scaleY=0.5;let b=new createjs.Text(game.lastScore.toLocaleString()+" m","30px riffic","#fff");b.y=375,b.x=50;let c=new createjs.Text(game.highScore.toLocaleString()+" m","30px riffic","#fff");c.y=515,c.x=50;let d=new createjs.Shape;d.graphics.beginFill("#fff").drawRect(108,683,268,83),d.alpha=0.01,d.addEventListener("click",game.start);let f=new createjs.Shape;f.graphics.beginFill("#fff").drawRect(456,577,50,120),f.alpha=0.01,f.addEventListener("click",game.showStartScreen),game.stage.addChild(a,d,f,c,b),game.showMute()},game.showMute=()=>{null!=game.muteBtn&&(game.stage.removeChild(game.muteBtn),game.muteBtn=null),game.muteBtn=createjs.Sound.muted?new createjs.Bitmap(game.queue.getResult("muted")):new createjs.Bitmap(game.queue.getResult("unmuted")),game.muteBtn.x=10,game.muteBtn.y=750,game.muteBtn.scaleX=game.muteBtn.scaleY=0.3,game.muteBtn.addEventListener("click",()=>{createjs.Sound.muted=!createjs.Sound.muted,game.showMute()}),game.stage.addChild(game.muteBtn)},game.showPause=a=>{null!=game.pauseBtn&&(game.stage.removeChild(game.pauseBtn),game.pauseBtn=null),game.pauseBtn=a.paused?new createjs.Bitmap(game.queue.getResult("continue")):new createjs.Bitmap(game.queue.getResult("pause")),game.pauseBtn.x=60,game.pauseBtn.y=750,game.pauseBtn.scaleX=game.pauseBtn.scaleY=0.4,game.pauseBtn.addEventListener("click",()=>{a.paused=!a.paused,game.showPause(a)}),game.stage.addChild(game.pauseBtn)},game.keyDown=a=>{if(game.started)switch(a.keyCode){case 37:game.keys.left=!0;break;case 39:game.keys.right=!0;}else 32==a.keyCode&&game.start();77==a.keyCode&&(createjs.Sound.muted=!createjs.Sound.muted,game.showMute())},game.keyUp=a=>{if(game.started)switch(a.keyCode){case 37:game.keys.left=!1;break;case 39:game.keys.right=!1;}},game.tilt=a=>{game.tilt=a.gamma;game.stage.canvas.width-game.player.width;90<game.tilt&&(game.tilt=90),-90>game.tilt&&(game.tilt=-90)};function msToTime(a){var b=c=>("00"+c).slice(-2);return b(0|a/3.6e6)+":"+b(0|a%3.6e6/6e4)+":"+b(0|a%6e4/1e3)+"."+b(a%1e3,3)}function getCookie(a){var b="; "+document.cookie,c=b.split("; "+a+"=");if(2==c.length)return c.pop().split(";").shift()}window.onkeydown=game.keyDown,window.onkeyup=game.keyUp,window.onload=game.init;